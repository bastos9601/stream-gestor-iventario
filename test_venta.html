<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Modal de Venta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Prueba del Modal de Venta</h1>
        <p>Esta es una página de prueba para verificar que el modal funcione correctamente.</p>
        
        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalVenta">
            <i class="fas fa-dollar-sign me-2"></i>
            Probar Modal de Venta
        </button>
    </div>

    <!-- Modal de Venta -->
    <div class="modal fade" id="modalVenta" tabindex="-1" aria-labelledby="modalVentaLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalVentaLabel">
                        <i class="fas fa-dollar-sign me-2"></i>
                        Vender Cuenta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="/test" id="formVenta">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="nombre_comprador" class="form-label">
                                <i class="fas fa-user me-2"></i>
                                Nombre del Comprador *
                            </label>
                            <input type="text" class="form-control" id="nombre_comprador" name="nombre_comprador" 
                                   required placeholder="Ingresa el nombre completo">
                        </div>
                        
                        <div class="mb-3">
                            <label for="whatsapp_comprador" class="form-label">
                                <i class="fab fa-whatsapp me-2"></i>
                                Número de WhatsApp *
                            </label>
                            <input type="tel" class="form-control" id="whatsapp_comprador" name="whatsapp_comprador" 
                                   required placeholder="Ej: +34612345678">
                            <div class="form-text">Incluye el código del país</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="fecha_vencimiento" class="form-label">
                                <i class="fas fa-calendar-alt me-2"></i>
                                Fecha de Vencimiento *
                            </label>
                            <input type="date" class="form-control" id="fecha_vencimiento" name="fecha_vencimiento" 
                                   required>
                            <div class="form-text">La cuenta debe vencer después de la fecha de compra</div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Información de la cuenta:</strong><br>
                            <strong>Plataforma:</strong> Netflix<br>
                            <strong>Email:</strong> test@example.com<br>
                            <strong>Precio:</strong> $15.00
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check me-2"></i>
                            Confirmar Venta
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Función para validar y enviar el formulario de venta
        function validarFormularioVenta(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('nombre_comprador').value.trim();
            const whatsapp = document.getElementById('whatsapp_comprador').value.trim();
            const fecha = document.getElementById('fecha_vencimiento').value;
            
            console.log('Validando formulario:', { nombre, whatsapp, fecha });
            
            if (!nombre || !whatsapp || !fecha) {
                alert('Por favor completa todos los campos obligatorios');
                return false;
            }
            
            // Validar formato de WhatsApp (debe incluir + y código de país)
            if (!whatsapp.startsWith('+')) {
                alert('El número de WhatsApp debe incluir el código del país (ej: +34612345678)');
                return false;
            }
            
            // Validar que la fecha de vencimiento sea futura
            const fechaVencimiento = new Date(fecha);
            const hoy = new Date();
            if (fechaVencimiento <= hoy) {
                alert('La fecha de vencimiento debe ser futura');
                return false;
            }
            
            if (confirm('¿Estás seguro de que quieres marcar esta cuenta como vendida?')) {
                console.log('Enviando formulario...');
                alert('¡Formulario válido! En una aplicación real, se enviaría al servidor.');
                // document.getElementById('formVenta').submit();
            }
        }

        // Configurar cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado, configurando formulario...');
            
            // Establecer fecha mínima para vencimiento (hoy)
            const fechaVencimiento = document.getElementById('fecha_vencimiento');
            if (fechaVencimiento) {
                const hoy = new Date();
                const fechaMinima = hoy.toISOString().split('T')[0];
                fechaVencimiento.min = fechaMinima;
                console.log('Fecha mínima establecida:', fechaMinima);
            }
            
            // Configurar el formulario cuando se abra el modal
            const modalVenta = document.getElementById('modalVenta');
            if (modalVenta) {
                modalVenta.addEventListener('shown.bs.modal', function() {
                    console.log('Modal abierto, configurando formulario...');
                    
                    // Limpiar campos del formulario
                    document.getElementById('nombre_comprador').value = '';
                    document.getElementById('whatsapp_comprador').value = '';
                    document.getElementById('fecha_vencimiento').value = '';
                    
                    // Establecer fecha mínima
                    const fechaVencimiento = document.getElementById('fecha_vencimiento');
                    if (fechaVencimiento) {
                        const hoy = new Date();
                        const fechaMinima = hoy.toISOString().split('T')[0];
                        fechaVencimiento.min = fechaMinima;
                    }
                });
            }
            
            // Agregar event listener al formulario
            const formVenta = document.getElementById('formVenta');
            if (formVenta) {
                console.log('Formulario encontrado, agregando event listener...');
                formVenta.addEventListener('submit', validarFormularioVenta);
            } else {
                console.error('Formulario no encontrado');
            }
        });
    </script>
</body>
</html>
